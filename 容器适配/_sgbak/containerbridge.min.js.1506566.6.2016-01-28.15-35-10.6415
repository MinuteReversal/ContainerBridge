function UnSupportedException(e){this.message=e}function ArgumentException(e){this.message=e}function IjsBridge(){}function ListenerItem(e,t){this.type="",this.listener=function(e){console.log(e)},e&&(this.type=e),t&&(this.listener=t)}function AjsBridge(){this.version="1.0",this.Listeners=[]}function AlipayBridge(){var e=this;e.ContainerType=ContainerType.Alipay,e._listenAlipayReady();var t=document.createElement("script");t.addEventListener("load",function(e){"undefined"==typeof AlipayJSBridge&&alert("not find AlipayJSBridge object!")}),document.querySelector("head").insertBefore(t,null),t.src=ContainerBridgeConfig.alipayJsUrl}function AndriodBridge(){var e=this;if(e.ContainerType=ContainerType.Android,e.options=null,"undefined"==typeof device)throw new Error("Not find interface");e._andriodReady()}function getQRcodeResult(e){ContainerBridge.options.complete(JSON.parse(e).QRCodeResult)}function H5Bridge(){this.ContainerType=ContainerType.PC}function IosBridge(){var e=this;e.options=null,this.ContainerType=ContainerType.iOS,window.addEventListener("load",function(){if("undefined"==typeof JSModel)throw new Error("Not find interface");e._iosReady()})}function onScanComplete(e){ContainerBridge.options.complete(e.qrValue)}function WechatBridge(){var e=this;e.ContainerType=ContainerType.Wechat;try{var t=document.createElement("script");t.addEventListener("load",function(t){"undefined"==typeof wx&&alert("没有找到微信接口！"),e._lisenWechatError(),e._wechatReady(),e._Config()}),document.querySelector("head").appendChild(t),t.src=ContainerBridgeConfig.wechatJsUrl}catch(n){alert(n.message)}}function BridgeFactory(){}var BridgeEventType={ready:"ready"};UnSupportedException.prototype=new Error,ArgumentException.prototype=new Error;var BridgeEventType={ready:"ready"},ContainerType={Wechat:"Wechat",Alipay:"Alipay",Android:"Android",WindowsPhone:"WindowsPhone",iOS:"iOS",PC:"PC"},ScanType={barCode:"barCode",qrCode:"qrCode",cardNumber:"cardNumber"};IjsBridge.prototype.extend=function(){throw new Error("not implement!")},IjsBridge.prototype.addEventListener=function(e,t){throw new Error("not implement!")},IjsBridge.prototype.dispatchEvent=function(e){throw new Error("not implement!")},IjsBridge.prototype.removeEventListener=function(e,t){throw new Error("not implement!")},IjsBridge.prototype.scan=function(e){throw new Error("not implement!")},AjsBridge.prototype=new IjsBridge,AjsBridge.prototype.extend=function(){for(var e,t={},n=0;e=arguments[n];n++)if(e&&"object"==typeof e)for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},AjsBridge.prototype.addEventListener=function(e,t){var n=this;n.Listeners.push(new ListenerItem(e,t))},AjsBridge.prototype.dispatchEvent=function(e){var t=this;t.Listeners.forEach(function(t,n,r){t.type===e&&t.listener(e)})},AjsBridge.prototype.removeEventListener=function(e,t){var n=this;n.Listeners.forEach(function(n,r,i){n.type===e&&n.listener===t&&i.splice(r,1)})},AjsBridge.prototype.DefaultScanOptions={scanType:ScanType.qrCode,complete:function(e){console.log(e)}},AlipayBridge.prototype=new AjsBridge,AlipayBridge.prototype._listenAlipayReady=function(){var e=this;document.addEventListener("AlipayJSBridgeReady",function(){e.dispatchEvent(BridgeEventType.ready)},!1)},AlipayBridge.prototype.scan=function(e){if(!e)throw new ArgumentException("scanOptions");var t=this,n=t.extend(t.DefaultScanOptions,e),r={type:"qr"};switch(n.scanType){case ScanType.barCode:r.type="bar";break;case ScanType.qrCode:r.type="qr";break;case ScanType.cardNumber:r.type="card"}AlipayJSBridge.call("scan",r,function(e){n.complete(e[n.scanType])})},AndriodBridge.prototype=new AjsBridge,AndriodBridge.prototype._andriodReady=function(){var e=this;e.dispatchEvent(BridgeEventType.ready)},AndriodBridge.prototype.scan=function(e){if(!e)throw new ArgumentException("options");var t=this,n=t.extend(t.DefaultScanOptions,e);if(n.scanType===ScanType.cardNumber)throw new UnSupportedException("cardNumber");t.options=n,device.scanQRcode()},H5Bridge.prototype=new AjsBridge,H5Bridge.prototype.scan=function(e){var t=this,n=t.extend(t.DefaultScanOptions,e);n.complete("Not Implement!")},IosBridge.prototype=new AjsBridge,IosBridge.prototype._iosReady=function(){var e=this;e.dispatchEvent(BridgeEventType.ready)},IosBridge.prototype.scan=function(e){if(!e)throw new ArgumentException("options");var t=this,n=t.extend(t.DefaultScanOptions,e);if(n.scanType===ScanType.cardNumber)throw new UnSupportedException("cardNumber");t.options=n,JSModel.callQrReaderView()},WechatBridge.prototype=new AjsBridge,WechatBridge.prototype._wechatReady=function(){var e=this;wx.ready(function(){e.dispatchEvent(BridgeEventType.ready)})},WechatBridge.prototype._lisenWechatError=function(){wx.error(function(e){alert(e)})},WechatBridge.prototype._Config=function(){var e=new XMLHttpRequest;try{e.open("GET",ContainerBridgeConfig.wechatSignatureApiUrl+"?appid="+ContainerBridgeConfig.wechatAppID+"&secret="+ContainerBridgeConfig.wechatAppSecret+"&url="+encodeURIComponent(location.href.split("#")[0])+"&_timestamp="+Date.now()),e.setRequestHeader("Accept","application/json"),e.onreadystatechange=function(t){if(4===e.readyState&&200===e.status)try{var n=e.responseText;ContainerBridgeConfig.debug&&alert(n);var r=JSON.parse(n),i={debug:ContainerBridgeConfig.debug,appId:r.AppId,timestamp:r.TimeStamp,nonceStr:r.Noncestr,signature:r.Signature,jsApiList:ContainerBridgeConfig.wechatAPIList};ContainerBridgeConfig.debug&&alert(JSON.stringify(i)),wx.config(i)}catch(o){alert(o.message)}},e.send()}catch(t){alert("xhr Error:"+t.message)}},WechatBridge.prototype.scan=function(e){var t=this,n=t.extend(t.DefaultScanOptions,e),r={needResult:1,scanType:["qrCode","barCode"],success:function(e){n.complete(e.resultStr)},fail:function(e){},complete:function(e){},cancel:function(e){}};if(n.scanType===ScanType.cardNumber)throw new UnSupportedException("Wechat UnSupportedException cardNumber");r.scanType=n.scanType,wx.scanQRCode(r)},BridgeFactory.prototype.Create=function(e){var t;return t=/MicroMessenger/gi.test(e)?new WechatBridge:/AlipayClient/gi.test(e)?new AlipayBridge:/AndroidShell/gi.test(e)?new AndriodBridge:/iOSshell/gi.test(e)?new IosBridge:new H5Bridge};var ContainerBridge=null;try{ContainerBridge=(new BridgeFactory).Create(window.navigator.userAgent)}catch(e){alert(e.message)}